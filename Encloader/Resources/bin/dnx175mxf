#!/bin/bash

usage()
{
cat << EOF
usage: $0 -i input_filename -o output_basename -t threads
EOF
}

IN=
OUT=
THREADS=1
while getopts "h:i:o:t:" OPTION
do
    case $OPTION in
        h)
            usage
            exit 1
            ;;
        i)
            IN=$OPTARG
            ;;
        o)
            OUT=$OPTARG
            ;;
        t)
            THREADS=$OPTARG
            ;;
        ?)
            usage
            exit
            ;;
    esac
done

ffmpeg -i $IN -vcodec dnxhd -b:v 175M -pix_fmt yuv422p -s 1920x1080 -acodec pcm_s16le -ar 48000 -ac 2 -y -threads ${THREADS} -vf "crop=in_w:in_h-8:0:0, scale=1920:1080" /tmp/temp.mov
ffmpeg -i /tmp/temp.mov -an -vcodec copy -y /tmp/temp.m2v
ffmpeg -i /tmp/temp.mov -vn -acodec pcm_s16le -y /tmp/temp.wav
writeavidmxf --prefix $OUT --film23.976 --DNxHD1080p175 /tmp/temp.m2v --wavpcm /tmp/temp.wav
