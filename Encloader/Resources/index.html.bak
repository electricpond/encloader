<html>
	<head>
    
    <title>Encloader</title>
    
    <script src="blackbirdjs/blackbird.js"></script>
    <link type="text/css" rel="stylesheet" href="blackbirdjs/blackbird.css" />
    
    <style type="text/css">
      * {
        font-family: "Helvetica Neue";
        box-sizing: border-box;
      }
      body {
        background-color: #e6e6e6;
        color: #666;
      }
      a {
        cursor: pointer;
        color: #666;
        text-decoration: none;
      }
      label {
        text-transform: uppercase;
        color: #6da7cf;
        font-size: 20px;
      }
      #container {
        margin-left: 20ex;
        border: 1px solid #999;
        -webkit-border-radius: 10px;
        background-color: #acacac;
        box-shadow: inset 1px 1px 10px -3px #666;
      }
      #container > div > div {
        border: 1px solid #999;
        border-right: 0;
        -webkit-border-radius: 10px;
        margin: 0 0 -1px -1px;
        background-color: #e6e6e6;
      }
      #container > div > div > div {
        padding: .5ex 1ex;
      }
      #container > div > h2 {
        color: #fbfbfb;
        margin: .4ex 1ex;
        text-transform: uppercase;
        font-weight: normal;
        font-size: 20px;
        text-align: right;
      }
      #container select {
        font-size: 20px;
        width: 150px;
      }
      #container select, #container input {
        float: right;
      }
      #container hr {
        border: 0;
        color: #666;
        background-color: #999;
        height: 1px;
      }

      #dropzone_div {
        height: 170px;
        color: #999;
        text-align: center;
      }
      #dropzone_div > div {
        position: absolute;
        text-align: center;
        margin-top: 10px;
      }
      #dropzone_div > div > img {
        border: 1px dashed #999;
        border-radius: 20px;
      }
      #dropzone_div > div > p {
        text-transform: uppercase;
      }
      #dropzone {
        opacity: 0;
        width: 100%;
        height: 100%;
      }
      .multi-select-container a {
        display: block;
        margin: .5ex 0;
        padding-right: 20px;
        background: no-repeat 100% 50% url(close.png);
        text-align: right;
        text-overflow: ellipsis;
        overflow: hidden;
      }
      .multi-select-container a:hover {
        background-image: url(close-hover.png);
      }

      #tabs {
        width: 20ex;
        float: left;
        padding-top: 5ex;
      }
      #tabs > a {
        display: block;
        border: 1px solid transparent;
        border-top-left-radius: 5px;
        border-bottom-left-radius: 5px;
        padding: .5ex;
        border-right: 0;
        margin-top: -1px;
      }
      #tabs > a:hover {
        border-color: #999;
      }
      #tabs > a.active {
        background-image: -webkit-gradient(linear, left top, left bottom, from(#d3dfea), to(#b0d1ea));
      }
    
    </style>
  </head>
	<body>
    
    <div id="tabs">
      <a href="">Progress</a>
      <a href="" class="active">Job 1</a>
      <a href="">Job 2</a>
      <a href="">+ add Job</a>
    </div>
    
    <div id="container">
      <div>
        <h2>Job 1</h2>
        <div>
          <div class="multi-select-container">
            <label>Encoders<select name="encoders" class="encoders">
                <option>Choose:</option>
                <!--
                <option>&nbsp;&nbsp;Local - Web Post HD</option>
                <option>&nbsp;&nbsp;Local - Web Post SD</option>
                <option>&nbsp;&nbsp;reidransom.com - Web Post HD</option>
                <option>&nbsp;&nbsp;reidransom.com - Web Post SD</option>
                -->
            </select></label>
            <!--
            <a href="#">reidransom.com - Web Post HD is all about the lizzadies</a>
            <a href="#">reidransomcomWebPostHDisallboutthelizzadies diablo</a>
            -->
          </div>
          <hr />
          <div class="multi-select-container">
            <label>Uploaders<select name="uploaders" class="uploaders">
                <option>Choose:</option>
                <!--
                <option>&nbsp;&nbsp;Local - Desktop</option>
                <option>&nbsp;&nbsp;Local - Choose a folder...</option>
                <option>&nbsp;&nbsp;reidransom.com - USA</option>
                <option>&nbsp;&nbsp;reidransom.com - TheCW</option>
                <option>&nbsp;&nbsp;reidransom.com - Choose a folder...</option>
                -->
            </select></label>
            <!--
            <a href="#">Local - Desktop</a>
            <a href="#">reidransom.com - Chiller/SnakesOnAPlane</a>
            -->
          </div>
          <hr />
          <div>
            <label>QT First Pass<input name="qtfirstpass" type="checkbox" /></label>
          </div>
          <hr />
          <div id="dropzone_div">
            <div>
              <img src="down-arrow.png" /><br />
              <p>Drop Files Here</p>
            </div>
            <textarea id="dropzone"></textarea>
          </div>
        </div>
      </div>
    </div>
    
    <script src="jquery.js"></script>
    <script src="mustache.js"></script>

    <script>
      
      Titanium.include("EncloaderDesktop.py");

      var PROJECT_ROOT = Titanium.App.appURLToPath("app://");
      
      // Fetch presets
      var presets = get_presets();
      var template = '<option value="{{value}}">&nbsp;&nbsp;{{html}}</option>';
      jQuery(presets).each(function(i, source) {
        jQuery(source.presets).each(function(j, preset) {
          jQuery(".encoders").append(Mustache.to_html(template, {
            value: i + "." + j,
            html: source.name + " - " + preset.name
          }));
        });
      });

      jQuery(".encoders").change(function() {
        var encoder = jQuery(".encoders").val().split(".");
        encoder = presets[encoder[0]*1].presets[encoder[1]*1];
        log.debug(encoder.name);
        jQuery(this).val("Choose:");
      });
      
      // Wait for files to be dropped on the dropzone
      var dz = document.getElementById("dropzone");
      window.setInterval(function() {
        var files = dz.value;
        if (files) {
          dz.value = "";
          var preset = jQuery(".encoders").val().split(".");
          preset = presets[preset[0]*1].presets[preset[1]*1];
          jQuery(files.split("\n")).each(function(i, file) {
            encode(file, preset, PROJECT_ROOT);
          });
        }
      }, 500);
    
    </script>
	
  </body>
</html>
